<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ifreework.mapper.system.RequestLogMapper">

	<sql id="requestLogColumns">
		REQUEST_LOG_ID,
		SESSION_ID,
		USERNAME,
		RESOURCE_ID,
		REQUEST_TIME,
		TIME_LENGTH,
		IP,
		BROWSER,
		BROWSER_VERSION,
		OS,
		DEVICE_TYPE,
		OS_INFO
	</sql>

	<resultMap type="com.ifreework.entity.system.RequestLog" id="requestLog">
		<id column="REQUEST_LOG_ID" property="requestLogId" />
		<result column="SESSION_ID" property="sessionId" />
		<result column="USERNAME" property="username" />
		<result column="RESOURCE_ID" property="resourceId" />
		<result column="REQUEST_TIME" property="requestTime" />
		<result column="TIME_LENGTH" property="timeLength" />
		<result column="IP" property="ip" />
		<result column="BROWSER" property="browser" />
		<result column="BROWSER_VERSION" property="browserVersion" />
		<result column="OS" property="os" />
		<result column="DEVICE_TYPE" property="deviceType" />
		<result column="OS_INFO" property="osInfo" />
		
		<association property="resource" javaType="com.ifreework.entity.system.Resource">
			<result column="RESOURCE_NAME" property="resourceName" />
			<result column="RESOURCE_URL" property="resourceUrl" />
		</association>
	</resultMap>


	
	<select id="queryPageList" parameterType="pd"
		resultMap="requestLog">
		select
			L.REQUEST_LOG_ID,
			L.SESSION_ID,
			L.USERNAME,
			L.RESOURCE_ID,
			L.REQUEST_TIME,
			L.TIME_LENGTH,
			L.IP,
			L.BROWSER,
			L.BROWSER_VERSION,
			L.OS,
			L.DEVICE_TYPE,
			L.OS_INFO,
			R.RESOURCE_NAME,
			R.RESOURCE_URL
		from SYS_REQUEST_LOG L
		join SYS_RESOURCE R ON L.RESOURCE_ID = R.RESOURCE_ID 
		<where>
			<trim  suffixOverrides="and">
				<if test=" username != null and  username != ''">
					and USERNAME like '%' || #{username} || '%'
				</if>
			</trim>
		</where>
		<foreach collection="columns" item="column" index="index"
            open="order by" close="" separator=",">
            <if test="column.orderable">
            	${column.name}   ${column.orderDir}
            </if>
        </foreach>
	</select>


	<insert id="add" parameterType="com.ifreework.entity.system.RequestLog">
		<selectKey keyProperty="requestLogId" resultType="String" order="BEFORE">
			select sys_guid() from dual
		</selectKey>
		insert into SYS_REQUEST_LOG (
		<include refid="requestLogColumns" />
		)
		values
		(
		#{ requestLogId,jdbcType=VARCHAR },
		#{ sessionId,jdbcType=VARCHAR },
		#{ username,jdbcType=VARCHAR },
		#{ resourceId,jdbcType=VARCHAR },
		#{ requestTime,jdbcType=DATE },
		#{ timeLength,jdbcType=INTEGER },
		#{ ip,jdbcType=VARCHAR },
		#{ browser,jdbcType=VARCHAR },
		#{ browserVersion,jdbcType=VARCHAR },
		#{ os,jdbcType=VARCHAR },
		#{ deviceType,jdbcType=VARCHAR },
		#{ osInfo,jdbcType=VARCHAR }
		)
	</insert>
</mapper>